#!/bin/bash

echo "üîç TESTE SIMPLES DE AMBIENTE ONLINE"
echo "=================================="

echo ""
echo "1Ô∏è‚É£ VERIFICANDO CONFIGURA√á√ïES B√ÅSICAS"
echo "==================================="

echo "üìã DEBUG: $(grep DEBUG .env)"
echo "üìã ALLOWED_HOSTS: $(grep ALLOWED_HOSTS .env)"
echo "üìã CSRF_TRUSTED_ORIGINS: $(grep CSRF_TRUSTED_ORIGINS .env)"

echo ""
echo "2Ô∏è‚É£ TESTANDO CONECTIVIDADE"
echo "========================"

echo "üìã Testando acesso ao site:"
curl -s -o /dev/null -w "Status: %{http_code}, Tempo: %{time_total}s\n" https://rh.institutoacqua.org.br/

echo "üìã Testando formul√°rio de vaga:"
curl -s -o /dev/null -w "Status: %{http_code}, Tempo: %{time_total}s\n" https://rh.institutoacqua.org.br/vacancies/vacancy/create/

echo ""
echo "3Ô∏è‚É£ VERIFICANDO CONTAINER"
echo "======================="

echo "üìã Status do container:"
docker ps --filter 'name=rh-acqua-web-1' --format "{{.Names}}: {{.Status}}"

echo ""
echo "4Ô∏è‚É£ POSS√çVEIS CAUSAS DO PROBLEMA"
echo "=============================="

echo "üîç Como o c√≥digo funciona no local mas n√£o online:"
echo ""
echo "1. ‚ùå PROBLEMA DE TIMEOUT"
echo "   - Requisi√ß√£o muito lenta no ambiente online"
echo "   - Container com poucos recursos"
echo "   - Banco de dados lento"
echo ""
echo "2. ‚ùå PROBLEMA DE SESS√ÉO/COOKIES"
echo "   - Sess√£o expira muito r√°pido"
echo "   - Cookies n√£o s√£o salvos corretamente"
echo "   - Problema de CSRF token"
echo ""
echo "3. ‚ùå PROBLEMA DE MIDDLEWARE"
echo "   - Middleware bloqueando requisi√ß√µes"
echo "   - Problema de autentica√ß√£o"
echo "   - Problema de permiss√µes"
echo ""
echo "4. ‚ùå PROBLEMA DE CACHE"
echo "   - Cache do Django interferindo"
echo "   - Cache do nginx"
echo "   - Cache do navegador"
echo ""
echo "5. ‚ùå PROBLEMA DE BANCO DE DADOS"
echo "   - Conex√£o lenta com banco"
echo "   - Transa√ß√£o n√£o commitada"
echo "   - Lock de tabela"

echo ""
echo "5Ô∏è‚É£ SOLU√á√ïES PARA TESTAR"
echo "======================"

echo "üéØ Teste estas solu√ß√µes:"
echo ""
echo "1. üîÑ LIMPAR CACHE:"
echo "   - Limpe o cache do navegador (Ctrl+F5)"
echo "   - Teste em modo inc√≥gnito"
echo "   - Reinicie o container: sudo docker restart rh-acqua-web-1"
echo ""
echo "2. ‚è±Ô∏è TESTAR TIMEOUT:"
echo "   - Aguarde mais tempo ap√≥s preencher o formul√°rio"
echo "   - N√£o clique v√°rias vezes no bot√£o salvar"
echo "   - Verifique se a p√°gina n√£o est√° travada"
echo ""
echo "3. üîê TESTAR SESS√ÉO:"
echo "   - Fa√ßa logout e login novamente"
echo "   - Verifique se est√° logado como recrutador"
echo "   - Teste em outra aba do navegador"
echo ""
echo "4. üóÑÔ∏è TESTAR BANCO:"
echo "   - Verifique se o banco est√° respondendo"
echo "   - Teste com dados mais simples"
echo "   - Verifique se n√£o h√° locks"

echo ""
echo "‚úÖ An√°lise conclu√≠da!"
echo ""
echo "üéØ RECOMENDA√á√ÉO:"
echo "Teste primeiro a solu√ß√£o 1 (limpar cache) e 2 (timeout)."
echo "Se n√£o funcionar, teste as outras solu√ß√µes."


