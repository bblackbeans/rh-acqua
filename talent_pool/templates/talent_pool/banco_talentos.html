{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Banco de Talentos - RH Acqua{% endblock %}

{% block content %}
<!-- Filtros Avançados -->
<div class="card mb-4">
    <div class="card-header">
        <h6 class="m-0 fw-bold text-primary">Filtros Avançados</h6>
    </div>
    <div class="card-body">
        <form method="get">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="skillsFilter" class="form-label">Habilidades</label>
                    <select class="form-select" id="skillsFilter" name="skills" multiple>
                        {% for skill in skills %}
                        <option value="{{ skill.name }}" 
                                {% if skill.name in filters.skills %}selected{% endif %}>
                            {{ skill.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="experienceFilter" class="form-label">Experiência</label>
                    <select class="form-select" id="experienceFilter" name="experience">
                        <option value="">Qualquer</option>
                        <option value="junior" {% if filters.experience == 'junior' %}selected{% endif %}>
                            Júnior (0-2 anos)
                        </option>
                        <option value="pleno" {% if filters.experience == 'pleno' %}selected{% endif %}>
                            Pleno (3-5 anos)
                        </option>
                        <option value="senior" {% if filters.experience == 'senior' %}selected{% endif %}>
                            Sênior (6+ anos)
                        </option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="educationFilter" class="form-label">Formação</label>
                    <select class="form-select" id="educationFilter" name="education">
                        <option value="">Qualquer</option>
                        <option value="tecnico" {% if filters.education == 'tecnico' %}selected{% endif %}>
                            Técnico
                        </option>
                        <option value="graduacao" {% if filters.education == 'graduacao' %}selected{% endif %}>
                            Graduação
                        </option>
                        <option value="especializacao" {% if filters.education == 'especializacao' %}selected{% endif %}>
                            Especialização
                        </option>
                        <option value="mestrado" {% if filters.education == 'mestrado' %}selected{% endif %}>
                            Mestrado
                        </option>
                        <option value="doutorado" {% if filters.education == 'doutorado' %}selected{% endif %}>
                            Doutorado
                        </option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="locationFilter" class="form-label">Localização</label>
                    <select class="form-select" id="locationFilter" name="location">
                        <option value="">Qualquer</option>
                        <option value="sp" {% if filters.location == 'sp' %}selected{% endif %}>
                            São Paulo
                        </option>
                        <option value="rj" {% if filters.location == 'rj' %}selected{% endif %}>
                            Rio de Janeiro
                        </option>
                        <option value="mg" {% if filters.location == 'mg' %}selected{% endif %}>
                            Belo Horizonte
                        </option>
                        <option value="rs" {% if filters.location == 'rs' %}selected{% endif %}>
                            Porto Alegre
                        </option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="availabilityFilter" class="form-label">Disponibilidade</label>
                    <select class="form-select" id="availabilityFilter" name="availability">
                        <option value="">Qualquer</option>
                        <option value="immediate" {% if filters.availability == 'immediate' %}selected{% endif %}>
                            Imediata
                        </option>
                        <option value="15days" {% if filters.availability == '15days' %}selected{% endif %}>
                            15 dias
                        </option>
                        <option value="30days" {% if filters.availability == '30days' %}selected{% endif %}>
                            30 dias
                        </option>
                        <option value="negotiable" {% if filters.availability == 'negotiable' %}selected{% endif %}>
                            A negociar
                        </option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="lastInterviewFilter" class="form-label">Última Entrevista</label>
                    <select class="form-select" id="lastInterviewFilter" name="last_interview">
                        <option value="">Qualquer</option>
                        <option value="never" {% if filters.last_interview == 'never' %}selected{% endif %}>
                            Nunca entrevistado
                        </option>
                        <option value="30days" {% if filters.last_interview == '30days' %}selected{% endif %}>
                            Últimos 30 dias
                        </option>
                        <option value="90days" {% if filters.last_interview == '90days' %}selected{% endif %}>
                            Últimos 90 dias
                        </option>
                        <option value="6months" {% if filters.last_interview == '6months' %}selected{% endif %}>
                            Últimos 6 meses
                        </option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="scoreFilter" class="form-label">Score Mínimo</label>
                    <input type="range" class="form-range" min="0" max="100" 
                           value="{{ filters.score|default:70 }}" id="scoreFilter" name="score">
                    <div class="d-flex justify-content-between">
                        <small>0</small>
                        <small>50</small>
                        <small>100</small>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="searchFilter" class="form-label">Busca</label>
                    <input type="text" class="form-control" id="searchFilter" name="search" 
                           placeholder="Nome, email, palavras-chave..." 
                           value="{{ filters.search|default:'' }}">
                </div>
            </div>
            <div class="row">
                <div class="col-12 text-end">
                    <a href="{% url 'talent_pool:banco_talentos' %}" class="btn btn-secondary me-2">
                        Limpar
                    </a>
                    <button type="submit" class="btn btn-primary">Filtrar</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Resultados -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h5>Talentos Encontrados ({{ total_talents }})</h5>
    <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-primary active">
            <i class="bi bi-grid"></i> Cards
        </button>
        <button type="button" class="btn btn-outline-primary">
            <i class="bi bi-list"></i> Lista
        </button>
    </div>
</div>

<!-- Visualização em Cards -->
<div class="row">
    {% for talent in page_obj %}
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <div class="badge bg-success fs-6">95</div>
                <div class="dropdown">
                    <button class="btn btn-sm" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-end">
                        <a class="dropdown-item" href="{% url 'talent_pool:talent_detail' talent.pk %}">
                            Ver Currículo
                        </a>
                        <a class="dropdown-item" href="{% url 'talent_pool:talent_edit' talent.pk %}">
                            Adicionar Nota
                        </a>
                        <a class="dropdown-item" href="#">Agendar Entrevista</a>
                        <a class="dropdown-item" href="#">Associar à Vaga</a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="text-center mb-3">
                    <img src="{% static 'img/avatar-candidate.png' %}" alt="Candidato" 
                         class="rounded-circle" style="width: 80px; height: 80px;">
                    <h5 class="mt-2 mb-0">
                        {{ talent.candidate.user.get_full_name|default:"Nome não informado" }}
                    </h5>
                    <p class="text-muted">
                        {{ talent.candidate.profession|default:"Profissão não informada" }}
                    </p>
                </div>
                <div class="mb-3">
                    <p class="mb-1">
                        <i class="bi bi-geo-alt"></i> 
                        {{ talent.candidate.city|default:"Localização não informada" }}
                    </p>
                    <p class="mb-1">
                        <i class="bi bi-briefcase"></i> 
                        {{ talent.candidate.years_experience|default:"0" }} anos de experiência
                    </p>
                    <p class="mb-1">
                        <i class="bi bi-mortarboard"></i> 
                        {{ talent.candidate.get_education_level_display|default:"Formação não informada" }}
                    </p>
                </div>
                <div class="mb-3">
                    {% for skill in talent.skills.all|slice:":3" %}
                    <span class="badge bg-light text-dark me-1 mb-1">{{ skill.skill.name }}</span>
                    {% endfor %}
                    {% if talent.skills.count > 3 %}
                    <span class="badge bg-light text-dark me-1 mb-1">+{{ talent.skills.count|add:"-3" }} mais</span>
                    {% endif %}
                </div>
            </div>
            <div class="card-footer">
                <div class="d-grid gap-2">
                    <a href="{% url 'talent_pool:talent_detail' talent.pk %}" class="btn btn-primary btn-sm">
                        Contatar
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="text-center py-5">
            <i class="bi bi-people display-1 text-muted"></i>
            <h4 class="mt-3 text-muted">Nenhum talento encontrado</h4>
            <p class="text-muted">Tente ajustar os filtros de busca.</p>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Paginação -->
{% if page_obj.has_other_pages %}
<nav aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                Anterior
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Anterior</a>
        </li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <li class="page-item active">
                <a class="page-link" href="#">{{ num }}</a>
            </li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <li class="page-item">
                <a class="page-link" href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                    {{ num }}
                </a>
            </li>
            {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                Próximo
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Próximo</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% endblock %}
