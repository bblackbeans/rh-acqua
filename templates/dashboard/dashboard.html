{% extends 'dashboard/base.html' %} {% load static %} {% block title %}Dashboard
- RH Acqua{% endblock %} {% block breadcrumb %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    {% for item in breadcrumb %} {% if forloop.last %}
    <li class="breadcrumb-item active" aria-current="page">{{ item.name }}</li>
    {% else %}
    <li class="breadcrumb-item">
      <a href="{{ item.url }}">{{ item.name }}</a>
    </li>
    {% endif %} {% endfor %}
  </ol>
</nav>
{% endblock %} {% block content %}
<div class="dashboard-container">
  <!-- Header do Dashboard -->
  <div class="dashboard-header">
    <div class="dashboard-title">
      <h1>Dashboard</h1>
      <p class="text-muted">Visão geral do sistema de RH</p>
    </div>
    <div class="dashboard-actions">
      <button class="btn btn-primary" onclick="refreshDashboard()">
        <i class="bi bi-arrow-clockwise"></i>
        Atualizar12
      </button>
    </div>
  </div>

  <!-- Widgets de Estatísticas -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon bg-primary">
        <i class="bi bi-people"></i>
      </div>
      <div class="stat-content">
        <h3 id="total-candidates">0</h3>
        <p>Total de Candidatos</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon bg-success">
        <i class="bi bi-briefcase"></i>
      </div>
      <div class="stat-content">
        <h3 id="total-vacancies">0</h3>
        <p>Vagas Ativas</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon bg-warning">
        <i class="bi bi-file-earmark-text"></i>
      </div>
      <div class="stat-content">
        <h3 id="total-applications">0</h3>
        <p>Candidaturas</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon bg-info">
        <i class="bi bi-calendar-check"></i>
      </div>
      <div class="stat-content">
        <h3 id="total-interviews">0</h3>
        <p>Entrevistas</p>
      </div>
    </div>
  </div>

  <!-- Gráficos e Tabelas -->
  <div class="dashboard-content">
    <div class="row">
      <!-- Gráfico de Candidaturas por Mês -->
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Candidaturas por Mês</h5>
          </div>
          <div class="card-body">
            <div id="applications-chart" style="height: 300px"></div>
          </div>
        </div>
      </div>

      <!-- Status dos Candidatos -->
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Status dos Candidatos</h5>
          </div>
          <div class="card-body">
            <div id="candidates-status-chart" style="height: 300px"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-4">
      <!-- Candidaturas Recentes -->
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Candidaturas Recentes</h5>
          </div>
          <div class="card-body">
            <div id="recent-applications">
              <div class="text-center text-muted">
                <i class="bi bi-hourglass-split fs-1"></i>
                <p>Carregando...</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Próximas Entrevistas -->
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Próximas Entrevistas</h5>
          </div>
          <div class="card-body">
            <div id="upcoming-interviews">
              <div class="text-center text-muted">
                <i class="bi bi-hourglass-split fs-1"></i>
                <p>Carregando...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  // Função para carregar dados do dashboard
  async function loadDashboardData() {
    try {
      const response = await fetch(
        '{% url "administration:dashboard_stats" %}'
      );
      const data = await response.json();

      if (data.success) {
        updateDashboardStats(data.data);
        updateCharts(data.data.chart_data);
        updateRecentApplications(data.data.recent_applications);
        updateUpcomingInterviews(data.data.upcoming_interviews);
      } else {
        console.error("Erro ao carregar dados:", data.error);
      }
    } catch (error) {
      console.error("Erro na requisição:", error);
    }
  }

  // Atualizar estatísticas
  function updateDashboardStats(stats) {
    document.getElementById("total-candidates").textContent =
      stats.total_candidates;
    document.getElementById("total-vacancies").textContent =
      stats.total_vacancies;
    document.getElementById("total-applications").textContent =
      stats.total_applications;
    document.getElementById("total-interviews").textContent =
      stats.total_interviews;
  }

  // Atualizar gráficos
  function updateCharts(chartData) {
    // Gráfico de candidaturas por mês
    if (
      chartData.applications_by_month &&
      chartData.applications_by_month.length > 0
    ) {
      chartManager.createLineChart("applications-chart", {
        data: chartData.applications_by_month,
      });
    }

    // Gráfico de status dos candidatos
    if (
      chartData.candidates_by_status &&
      chartData.candidates_by_status.length > 0
    ) {
      chartManager.createPieChart("candidates-status-chart", {
        data: chartData.candidates_by_status,
      });
    }
  }

  // Atualizar candidaturas recentes
  function updateRecentApplications(applications) {
    const container = document.getElementById("recent-applications");

    if (applications.length === 0) {
      container.innerHTML =
        '<p class="text-muted text-center">Nenhuma candidatura recente</p>';
      return;
    }

    const html = applications
      .map(
        (app) => `
        <div class="application-item">
            <div class="application-info">
                <h6>${app.candidate_name}</h6>
                <p class="text-muted">${app.vacancy_title}</p>
                <small class="text-muted">${Utils.formatDate(
                  app.created_at
                )}</small>
            </div>
            <div class="application-status">
                <span class="badge ${app.status === 'pending' ? 'bg-warning text-dark' : app.status === 'under_review' ? 'bg-info' : app.status === 'interview' ? 'bg-primary' : app.status === 'approved' ? 'bg-success' : app.status === 'rejected' ? 'bg-danger' : 'bg-secondary'}">${app.status}</span>
            </div>
        </div>
    `
      )
      .join("");

    container.innerHTML = html;
  }

  // Atualizar próximas entrevistas
  function updateUpcomingInterviews(interviews) {
    const container = document.getElementById("upcoming-interviews");

    if (interviews.length === 0) {
      container.innerHTML =
        '<p class="text-muted text-center">Nenhuma entrevista agendada</p>';
      return;
    }

    const html = interviews
      .map(
        (interview) => `
        <div class="interview-item">
            <div class="interview-info">
                <h6>${interview.candidate_name}</h6>
                <p class="text-muted">${interview.vacancy_title}</p>
                <small class="text-muted">
                    <i class="bi bi-calendar"></i>
                    ${Utils.formatDateTime(interview.scheduled_at)}
                </small>
            </div>
            <div class="interview-actions">
                <button class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-eye"></i>
                </button>
            </div>
        </div>
    `
      )
      .join("");

    container.innerHTML = html;
  }

  // Função para atualizar dashboard
  function refreshDashboard() {
    loadDashboardData();
  }

  // Carregar dados quando a página carregar
  document.addEventListener("DOMContentLoaded", function () {
    loadDashboardData();

    // Atualizar a cada 5 minutos
    setInterval(loadDashboardData, 5 * 60 * 1000);
  });
</script>
{% endblock %}
