{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Vagas Disponíveis - RH Acqua{% endblock %}

{% block content %}
<!-- Filtros - COMENTADO TEMPORARIAMENTE -->
<!--
<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title">Filtros</h5>
    <form method="get" class="row g-3">
      <div class="col-md-4">
        <label for="unidade" class="form-label">Unidade</label>
        <select id="unidade" name="unidade" class="form-select">
          <option value="" {% if not unidade_filter %}selected{% endif %}>Todas</option>
          {% for hospital in hospitals %}
          <option value="{{ hospital.name }}" {% if unidade_filter == hospital.name %}selected{% endif %}>{{ hospital.name }} - {{ hospital.city }}, {{ hospital.state }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label for="cargo" class="form-label">Cargo</label>
        <select id="cargo" name="cargo" class="form-select">
          <option value="" {% if not cargo_filter %}selected{% endif %}>Todos</option>
          {% for category in categories %}
          <option value="{{ category.name }}" {% if cargo_filter == category.name %}selected{% endif %}>{{ category.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label for="regiao" class="form-label">Região</label>
        <select id="regiao" name="regiao" class="form-select">
          <option value="" {% if not regiao_filter %}selected{% endif %}>Todas</option>
          {% for region in regions %}
          <option value="{{ region }}" {% if regiao_filter == region %}selected{% endif %}>{{ region }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-primary">Filtrar</button>
        <a href="{% url 'vacancies:vagas_disponiveis' %}" class="btn btn-outline-secondary">Limpar</a>
      </div>
    </form>
  </div>
</div>
-->

<!-- Vagas -->
<div class="row">
  <div class="col-12">
    {% if total_vagas > 0 %}
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">
          <i class="bi bi-briefcase me-2 text-primary"></i>
          {{ total_vagas }} vaga{{ total_vagas|pluralize:"s" }} encontrada{{ total_vagas|pluralize:"s" }}
        </h5>
        {% if unidade_filter or cargo_filter or regiao_filter %}
          <div class="text-muted small">
            <i class="bi bi-funnel me-1"></i>
            Filtros aplicados
          </div>
        {% endif %}
      </div>
    {% endif %}
  </div>
  
  {% if total_vagas == 0 and not unidade_filter and not cargo_filter and not regiao_filter %}
    <!-- Mensagem para quando não há vagas no sistema -->
    <div class="col-12">
      <div class="text-center py-5">
        <div class="mb-4">
          <i class="bi bi-briefcase" style="font-size: 4rem; color: #6c757d;"></i>
        </div>
        <h4 class="text-muted mb-3">Nenhuma vaga disponível</h4>
        <p class="text-muted mb-2">Ainda não há vagas publicadas no sistema.</p>
        <p class="text-muted small">Os recrutadores podem criar e publicar vagas que aparecerão aqui.</p>
        <div class="mt-4">
          <div class="d-inline-block p-3 bg-light rounded">
            <i class="bi bi-info-circle text-primary me-2"></i>
            <span class="text-muted small">Esta página será atualizada automaticamente quando novas vagas forem publicadas.</span>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
  
  {% if total_vagas > 0 %}
    {% for vaga in vagas %}
    <div class="col-lg-4 col-md-6 mb-4">
      <div class="card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <h5 class="card-title">{{ vaga.title }}</h5>
            {% if vaga.is_new %}
            <span class="badge bg-primary">Novo</span>
            {% endif %}
          </div>
          <h6 class="card-subtitle mb-2 text-muted">{{ vaga.hospital.name }}</h6>
          <p class="card-text"><i class="bi bi-geo-alt"></i> {{ vaga.hospital.city }}, {{ vaga.hospital.state }}</p>
          <p class="card-text"><i class="bi bi-calendar3"></i> 
            {% if vaga.publication_date %}
              Publicada há 
              {% if vaga.days_since_publication == 0 %}
                hoje
              {% elif vaga.days_since_publication == 1 %}
                1 dia
              {% elif vaga.days_since_publication < 7 %}
                {{ vaga.days_since_publication }} dias
              {% elif vaga.days_since_publication < 30 %}
                {{ vaga.days_since_publication|divisibleby:7 }} semanas
              {% else %}
                {{ vaga.days_since_publication|divisibleby:30 }} meses
              {% endif %}
            {% else %}
              Data não informada
            {% endif %}
          </p>
          
          {% comment %} {% if vaga.category %}
          <p class="card-text"><i class="bi bi-tag"></i> {{ vaga.category.name }}</p>
          {% endif %} {% endcomment %}
          
          {% comment %} {% if vaga.contract_type %}
          <p class="card-text"><i class="bi bi-file-earmark-text"></i> {{ vaga.get_contract_type_display }}</p>
          {% endif %} {% endcomment %}
          
          <hr>
          <div class="d-flex gap-2 mt-3">
            <a href="{% url 'vacancies:public_vacancy_detail' vaga.slug %}" class="btn btn-sm btn-outline-primary">
              <i class="bi bi-eye me-1"></i>Ver Detalhes
            </a>
            {% if user.is_authenticated and user.role == 'candidate' %}
              <a href="{% url 'vacancies:candidatura' vaga.pk %}" class="btn btn-sm btn-primary">Candidatar-se</a>
            {% elif user.is_authenticated and user.role != 'candidate' %}
              <span class="btn btn-sm btn-secondary disabled" title="Apenas candidatos podem se candidatar">
                <i class="bi bi-lock me-1"></i>Candidatar-se
              </span>
            {% elif not user.is_authenticated %}
              <a href="{% url 'users:login' %}?next={% url 'vacancies:candidatura' vaga.pk %}" class="btn btn-sm btn-primary">Candidatar-se</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <!-- Mensagem para quando não há vagas com os filtros aplicados -->
    <div class="col-12">
      <div class="text-center py-5">
        <div class="mb-4">
          <i class="bi bi-search" style="font-size: 4rem; color: #6c757d;"></i>
        </div>
        <h4 class="text-muted mb-3">Nenhuma vaga encontrada</h4>
        <p class="text-muted mb-2">Não há vagas disponíveis com os filtros selecionados.</p>
        <p class="text-muted small">Tente ajustar os filtros ou aguarde novas vagas serem publicadas.</p>
        <div class="mt-4">
          <a href="{% url 'vacancies:vagas_disponiveis' %}" class="btn btn-outline-primary">
            <i class="bi bi-arrow-clockwise me-2"></i>Limpar Filtros
          </a>
        </div>
        {% if total_vagas > 0 %}
        <div class="mt-3">
          <div class="d-inline-block p-2 bg-light rounded">
            <i class="bi bi-info-circle text-info me-2"></i>
            <span class="text-muted small">Existem {{ total_vagas }} vagas no sistema. Tente ajustar os filtros para encontrá-las.</span>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  {% endif %}
</div>

<!-- Paginação -->
{% if vagas.has_other_pages %}
<nav aria-label="Navegação de páginas">
  <ul class="pagination justify-content-center">
    {% if vagas.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ vagas.previous_page_number }}{% if unidade_filter %}&unidade={{ unidade_filter }}{% endif %}{% if cargo_filter %}&cargo={{ cargo_filter }}{% endif %}{% if regiao_filter %}&regiao={{ regiao_filter }}{% endif %}">Anterior</a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <span class="page-link">Anterior</span>
      </li>
    {% endif %}

    {% for num in vagas.paginator.page_range %}
      {% if vagas.number == num %}
        <li class="page-item active">
          <span class="page-link">{{ num }}</span>
        </li>
      {% elif num > vagas.number|add:'-3' and num < vagas.number|add:'3' %}
        <li class="page-item">
          <a class="page-link" href="?page={{ num }}{% if unidade_filter %}&unidade={{ unidade_filter }}{% endif %}{% if cargo_filter %}&cargo={{ cargo_filter }}{% endif %}{% if regiao_filter %}&regiao={{ regiao_filter }}{% endif %}">{{ num }}</a>
        </li>
      {% endif %}
    {% endfor %}

    {% if vagas.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ vagas.next_page_number }}{% if unidade_filter %}&unidade={{ unidade_filter }}{% endif %}{% if cargo_filter %}&cargo={{ cargo_filter }}{% endif %}{% if regiao_filter %}&regiao={{ regiao_filter }}{% endif %}">Próxima</a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <span class="page-link">Próxima</span>
      </li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endblock %}
